# CI/CD: Continuous Integration и Continuous Delivery/Deployment

CI/CD — это практики и инструменты, которые помогают автоматизировать процессы разработки, тестирования и развертывания программного обеспечения. Они направлены на ускорение delivery (доставки) и deployment (развертывания) кода, а также на повышение качества и стабильности продукта.

## Основные понятия

### Continuous Integration (CI) — Непрерывная интеграция

Это процесс автоматического слияния изменений кода от нескольких разработчиков в общую ветку (например, `main` или `master`). Основная цель CI — выявлять ошибки на ранних этапах, запуская автоматические тесты после каждого коммита.

#### Как это работает:

1. Разработчик создает feature-ветку, вносит изменения и делает pull request (PR).
2. CI-система автоматически запускает сборку (build) и тесты.
3. Если тесты проходят успешно, изменения могут быть объединены в основную ветку.

#### Преимущества:

- Раннее обнаружение ошибок.
- Упрощение процесса слияния кода.
- Повышение скорости разработки.

### Continuous Delivery (CD) — Непрерывная доставка

Это практика, при которой код после успешного прохождения CI автоматически подготавливается к развертыванию в production-окружении. Однако само развертывание может быть выполнено вручную.

#### Как это работает:

1. После успешного CI код автоматически деплоится на staging-окружение.
2. Тестирование на staging может включать нагрузочные тесты, тесты на безопасность и т.д.
3. После проверки код может быть развернут в production вручную.

#### Преимущества:

- Готовность кода к развертыванию в любой момент.
- Снижение рисков при релизах.

### Continuous Deployment (CD) — Непрерывное развертывание

Это расширение Continuous Delivery, при котором код автоматически развертывается в production после успешного прохождения всех тестов.

#### Как это работает:

1. После успешного CI и тестирования на staging код автоматически деплоится в production.
2. Процесс полностью автоматизирован, без ручного вмешательства.

#### Преимущества:

- Максимальная скорость доставки изменений пользователям.
- Минимизация человеческого фактора.

## CI/CD Цикл

1. **Разработка:**
   Разработчик создает feature-ветку, вносит изменения и делает коммит.

2. **Сборка (Build):**
   CI-система автоматически собирает проект (например, компилирует код, создает артефакты).

3. **Тестирование:**
   Запускаются автоматические тесты (unit-тесты, интеграционные тесты, e2e-тесты).

4. **Деплой на staging:**
   Если тесты прошли успешно, код автоматически деплоится на staging-окружение для дополнительного тестирования.

5. **Ручное или автоматическое развертывание в production:**
   В случае Continuous Delivery развертывание в production выполняется вручную. В случае Continuous Deployment — автоматически.

## Инструменты CI/CD

### Jenkins

Один из самых популярных инструментов с открытым исходным кодом. Поддерживает огромное количество плагинов для интеграции с различными технологиями.

#### Преимущества:

- Гибкость и расширяемость.
- Поддержка множества языков и технологий.

#### Недостатки:

- Требует настройки и поддержки.
- Интерфейс может быть сложным для новичков.

### GitLab CI/CD

Встроенный инструмент CI/CD в GitLab. Позволяет настраивать pipelines через `.gitlab-ci.yml`.

#### Преимущества:

- Интеграция с GitLab.
- Простота настройки.

#### Недостатки:

- Ограниченная гибкость по сравнению с Jenkins.

### GitHub Actions

Инструмент CI/CD, встроенный в GitHub. Позволяет настраивать workflows через YAML-файлы.

#### Преимущества:

- Интеграция с GitHub.
- Простота использования.

#### Недостатки:

- Ограниченная функциональность для сложных сценариев.

### CircleCI

Облачный инструмент CI/CD, который поддерживает Docker и Kubernetes.

#### Преимущества:

- Простота настройки.
- Хорошая интеграция с GitHub и Bitbucket.

#### Недостатки:

- Ограниченная бесплатная версия.

## Docker: Контейнеризация

Docker — это платформа для разработки, доставки и запуска приложений в контейнерах. Контейнеры — это изолированные среды, которые содержат все необходимое для работы приложения: код, библиотеки, зависимости и runtime.

### Основные понятия:

- **Образ (Image):** Шаблон для создания контейнеров. Например, образ Ubuntu, Node.js, PostgreSQL.
- **Контейнер (Container):** Запущенный экземпляр образа.
- **Dockerfile:** Файл с инструкциями для создания образа.
- **Docker Compose:** Инструмент для управления многоконтейнерными приложениями.

### Преимущества Docker:

- **Изоляция:** Приложения работают в изолированных средах.
- **Портативность:** Контейнеры могут быть запущены на любой системе с Docker.
- **Эффективность:** Контейнеры используют меньше ресурсов, чем виртуальные машины.

### Пример Dockerfile:

```dockerfile
FROM node:14
WORKDIR /app
COPY package.json .
RUN npm install
COPY . .
CMD ["npm", "start"]
```

### Пример Docker Compose:

```yaml
version: '3'
services:
  web:
    image: nginx
    ports:
      - "80:80"
  db:
    image: postgres
    environment:
      POSTGRES_PASSWORD: example
```

## Виртуализация vs Контейнеризация

### Виртуализация:

- Использует гипервизор (например, VMware, VirtualBox) для создания виртуальных машин (VM).
- Каждая VM имеет свою операционную систему.
- Высокий уровень изоляции, но большие накладные расходы.

### Контейнеризация:

- Использует ядро хостовой ОС для изоляции процессов.
- Контейнеры легче и быстрее, чем VM.
- Меньше накладных расходов, но меньшая изоляция по сравнению с VM.