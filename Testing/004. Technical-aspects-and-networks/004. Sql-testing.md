# SQL и тестирование баз данных

**SQL** (Structured Query Language) — это язык запросов, используемый для управления и манипуляции данными в реляционных базах данных. В контексте тестирования баз данных SQL играет ключевую роль, поскольку позволяет проверять данные, выполнять запросы и обеспечивать корректность функционирования баз данных.

## Основные операции SQL для тестирования

1. **SELECT**: Используется для извлечения данных из базы данных.
   - Примеры:
     - Проверка, что нужные данные присутствуют в таблице.
     - Убедиться, что данные соответствуют ожиданиям после выполнения операций вставки или обновления.

2. **INSERT**: Используется для добавления новых данных в таблицы.
   - Примеры:
     - Проверка, что данные были успешно добавлены.
     - Убедиться, что добавленные данные соответствуют требованиям.

3. **UPDATE**: Используется для изменения существующих данных в таблицах.
   - Примеры:
     - Проверка, что данные были обновлены правильно.
     - Убедиться, что изменения корректно отражены в базе данных.

4. **DELETE**: Используется для удаления данных из таблиц.
   - Примеры:
     - Проверка, что данные были удалены.
     - Убедиться, что удаление не привело к нарушению целостности данных.

5. **CREATE TABLE**: Используется для создания новых таблиц в базе данных.
   - Примеры:
     - Проверка, что таблицы создаются с правильной структурой.
     - Убедиться, что все ограничения и индексы корректно применяются.

6. **ALTER TABLE**: Используется для изменения структуры существующих таблиц.
   - Примеры:
     - Проверка, что структура таблицы изменена корректно.
     - Убедиться, что новые столбцы и ограничения добавлены правильно.

7. **DROP TABLE**: Используется для удаления таблиц из базы данных.
   - Примеры:
     - Проверка, что таблицы удаляются полностью и корректно.
     - Убедиться, что удаление не приводит к ошибкам в других частях базы данных.

## Методы тестирования баз данных

1. **Тестирование данных**
   - Проверка корректности данных, хранящихся в базе данных.
   - Включает проверку целостности данных, соответствия требованиям и правильности значений.

2. **Тестирование структуры базы данных**
   - Проверка правильности структуры базы данных, включая таблицы, столбцы, типы данных, ограничения и индексы.
   - Убедиться, что структура базы данных соответствует проектной документации.

3. **Тестирование производительности**
   - Проверка производительности запросов и операций с базой данных.
   - Включает измерение времени выполнения запросов, тестирование нагрузки и проверку оптимизации индексов.

4. **Тестирование безопасности**
   - Проверка мер безопасности, применяемых к базе данных.
   - Включает проверку прав доступа, аутентификации и защиты от SQL-инъекций.

5. **Тестирование целостности данных**
   - Проверка того, что данные остаются целыми и непротиворечивыми при выполнении операций вставки, обновления и удаления.
   - Включает проверку внешних ключей, уникальных ограничений и транзакций.

6. **Тестирование резервного копирования и восстановления**
   - Проверка процессов резервного копирования и восстановления данных.
   - Убедиться, что резервные копии создаются и восстанавливаются корректно.

## Примеры тестов для баз данных

- **Тест на целостность данных**: Проверка того, что после выполнения операций вставки и обновления данные в таблицах остаются корректными и соответствуют требованиям.
- **Тест на производительность запросов**: Измерение времени выполнения запросов и анализ их эффективности для оптимизации базы данных.
- **Тест на безопасность**: Проверка, что только авторизованные пользователи могут выполнять определённые операции и доступ к данным защищён от несанкционированного доступа.

## Шпаргалка по SQL с примерами использования

| **Категория**                    | **Ключевое слово** | **Описание**                                                                                                    | **Пример**                             |
|----------------------------------|---------------------|----------------------------------------------------------------------------------------------------------------|----------------------------------------|
| **Объединение и агрегация данных** | `JOIN`            | Объединяет строки из двух таблиц на основе общего столбца.                                                     | `SELECT * FROM A JOIN B ON A.id = B.id;` |
|                                  | `INNER JOIN`       | Возвращает только строки с совпадениями в обеих таблицах.                                                      | `SELECT * FROM A INNER JOIN B ON A.id = B.id;` |
|                                  | `LEFT JOIN`        | Возвращает все строки из левой таблицы и соответствующие строки из правой.                                     | `SELECT * FROM A LEFT JOIN B ON A.id = B.id;` |
|                                  | `RIGHT JOIN`       | Возвращает все строки из правой таблицы и соответствующие строки из левой.                                     | `SELECT * FROM A RIGHT JOIN B ON A.id = B.id;` |
|                                  | `FULL OUTER JOIN`  | Возвращает все строки из обеих таблиц, включая строки без совпадений.                                          | `SELECT * FROM A FULL OUTER JOIN B ON A.id = B.id;` |
|                                  | `GROUP BY`         | Группирует результаты по одному или нескольким столбцам.                                                       | `SELECT dept, COUNT(*) FROM employees GROUP BY dept;` |
|                                  | `HAVING`           | Фильтрует группы, созданные с помощью GROUP BY.                                                                | `SELECT dept, COUNT(*) FROM employees GROUP BY dept HAVING COUNT(*) > 5;` |
|                                  | `COUNT`            | Подсчитывает количество строк или непустых значений.                                                           | `SELECT COUNT(*) FROM employees;` |
|                                  | `SUM`              | Вычисляет сумму числовых значений в группе.                                                                    | `SELECT SUM(salary) FROM employees;` |
|                                  | `AVG`              | Вычисляет среднее значение числовых значений в группе.                                                         | `SELECT AVG(salary) FROM employees;` |
|                                  | `MIN`              | Находит минимальное значение в группе.                                                                         | `SELECT MIN(salary) FROM employees;` |
|                                  | `MAX`              | Находит максимальное значение в группе.                                                                        | `SELECT MAX(salary) FROM employees;` |

| **Фильтрация данных**            | **Ключевое слово** | **Описание**                                                                                                    | **Пример**                             |
|----------------------------------|---------------------|----------------------------------------------------------------------------------------------------------------|----------------------------------------|
| **Фильтрация**                   | `WHERE`            | Фильтрует строки на основе условия.                                                                            | `SELECT * FROM employees WHERE age > 30;` |
|                                  | `BETWEEN`          | Проверяет, находится ли значение в указанном диапазоне.                                                        | `SELECT * FROM employees WHERE age BETWEEN 25 AND 35;` |
|                                  | `IN`               | Проверяет, содержится ли значение в списке.                                                                    | `SELECT * FROM employees WHERE dept IN ('IT', 'Sales');` |
|                                  | `LIKE`             | Ищет строки по шаблону.                                                                                        | `SELECT * FROM employees WHERE name LIKE 'A%';` |
|                                  | `IS NULL`          | Проверяет, является ли значение NULL.                                                                          | `SELECT * FROM employees WHERE manager_id IS NULL;` |
|                                  | `IS NOT NULL`      | Проверяет, не является ли значение NULL.                                                                       | `SELECT * FROM employees WHERE manager_id IS NOT NULL;` |
|                                  | `EXISTS`           | Проверяет, возвращает ли подзапрос строки.                                                                     | `SELECT * FROM employees WHERE EXISTS (SELECT 1 FROM dept WHERE dept.id = employees.dept_id);` |

| **Функции для работы с данными** | **Ключевое слово** | **Описание**                                                                                                    | **Пример**                             |
|----------------------------------|---------------------|----------------------------------------------------------------------------------------------------------------|----------------------------------------|
| **Условные функции**             | `COALESCE`         | Возвращает первое не-NULL значение из списка выражений.                                                        | `SELECT COALESCE(manager_id, 0) FROM employees;` |
|                                  | `NULLIF`           | Возвращает NULL, если два выражения равны; иначе возвращает первое.                                            | `SELECT NULLIF(salary, 0) FROM employees;` |
|                                  | `CASE WHEN`        | Создает условные выражения.                                                                                    | `SELECT CASE WHEN salary > 5000 THEN 'High' ELSE 'Low' END FROM employees;` |
|                                  | `CAST`             | Преобразует данные к указанному типу.                                                                          | `SELECT CAST(salary AS FLOAT) FROM employees;` |
|                                  | `CONVERT`          | Преобразует выражение к заданному типу данных.                                                                 | `SELECT CONVERT(VARCHAR, salary) FROM employees;` |

| **Модификация данных**           | **Ключевое слово** | **Описание**                                                                                                    | **Пример**                             |
|----------------------------------|---------------------|----------------------------------------------------------------------------------------------------------------|----------------------------------------|
| **Операции с данными (CRUD)**    | `INSERT`           | Добавляет новые строки в таблицу.                                                                              | `INSERT INTO employees (name, dept) VALUES ('Alice', 'HR');` |
|                                  | `UPDATE`           | Обновляет существующие строки в таблице.                                                                       | `UPDATE employees SET salary = 6000 WHERE id = 1;` |
|                                  | `DELETE`           | Удаляет строки из таблицы.                                                                                     | `DELETE FROM employees WHERE id = 1;` |
|                                  | `MERGE`            | Объединяет операции `INSERT`, `UPDATE` и `DELETE` на основе условий.                                           | `MERGE INTO employees AS target USING new_employees AS source ON target.id = source.id ...` |

| **Разное**                       | **Ключевое слово** | **Описание**                                                                                                    | **Пример**                             |
|----------------------------------|---------------------|----------------------------------------------------------------------------------------------------------------|----------------------------------------|
| **Другие команды**               | `DISTINCT`         | Удаляет дубликаты из результата запроса.                                                                       | `SELECT DISTINCT dept FROM employees;` |
|                                  | `ORDER BY`         | Сортирует результаты запроса по указанным столбцам.                                                            | `SELECT * FROM employees ORDER BY salary DESC;` |
|                                  | `LIMIT`            | Ограничивает количество возвращаемых строк.                                                                    | `SELECT * FROM employees LIMIT 10;` |
|                                  | `OFFSET`           | Пропускает указанное количество строк перед началом возврата результатов.                                      | `SELECT * FROM employees OFFSET 5;` |
|                                  | `UNION`            | Объединяет результаты двух или более SELECT операторов, удаляя дубликаты.                                      | `SELECT name FROM A UNION SELECT name FROM B;` |
|                                  | `UNION ALL`        | Объединяет результаты двух или более SELECT операторов, включая дубликаты.                                     | `SELECT name FROM A UNION ALL SELECT name FROM B;` |
|                                  | `WITH`             | Определяет общее табличное выражение (CTE) для подзапросов.                                                   | `WITH DeptAvg AS (SELECT dept, AVG(salary) AS avg_salary FROM employees GROUP BY dept) SELECT * FROM DeptAvg;` |
|                                  | `EXPLAIN`          | Показывает план выполнения запроса, полезно для оптимизации.                                                   | `EXPLAIN SELECT * FROM employees WHERE age > 30;` |
|                                  | `INDEX`            | Создает индекс для ускорения запросов.                                                                         | `CREATE INDEX idx_salary ON employees (salary);` |
|                                  | `VIEW`             | Создает виртуальную таблицу на основе запроса.                                                                 | `CREATE VIEW high_salaries AS SELECT * FROM employees WHERE salary > 5000;` |
|                                  | `TRIGGER`          | Настраивает автоматические действия, выполняемые при определенных событиях базы данных.                        | `CREATE TRIGGER before_insert BEFORE INSERT ON employees FOR EACH ROW BEGIN ... END;` |
|                                  | `TRANSACTION`      | Управляет последовательностью операций как единой транзакцией.                                                 | `BEGIN TRANSACTION; ... COMMIT;` |
|                                  | `ROLLBACK`         | Отменяет транзакцию до сохраненной точки или начала.                                                           | `ROLLBACK;` |
|                                  | `COMMIT`           | Сохраняет изменения, сделанные в транзакции.                                                                   | `COMMIT;` |
|                                  | `SAVEPOINT`        | Создает точку внутри транзакции, к которой можно откатиться.                                                   | `SAVEPOINT sp1;` |
